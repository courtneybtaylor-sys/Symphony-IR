template_id: "incident_response"
name: "Incident Response"
description: "Structured incident response workflow: detection, triage, containment, remediation, and postmortem"
domain: "security"
industry: "cross-industry"
difficulty_level: "intermediate"
estimated_duration: "1-3 hours"
tags: ["incident", "security", "operations", "on-call", "sre", "devops", "postmortem"]
required_context: ["incident_id", "affected_system"]

nodes:
  start:
    summary: "Responding to incident {incident_id} on {affected_system}"
    role: "architect"
    intent: "Manage and resolve incident {incident_id} affecting {affected_system}"
    phase: "PLANNING"
    priority: 10
    context_refs:
      - "file:{affected_system}"
    constraints:
      - "Immediately assess: scope, severity, and user impact"
      - "Declare incident severity: P1 (critical), P2 (high), P3 (medium), P4 (low)"
    token_budget_hint: 800
    options:
      - id: "A"
        label: "P1/P2: Active Outage"
        description: "Service down or severely degraded — all hands response"
        next_node_id: "immediate_triage"
      - id: "B"
        label: "P3/P4: Degraded Performance"
        description: "Service impacted but operational — scheduled remediation"
        next_node_id: "investigation"
      - id: "C"
        label: "Security Breach"
        description: "Unauthorized access or data exposure detected"
        next_node_id: "security_containment"

  immediate_triage:
    summary: "Immediate triage of {incident_id}"
    role: "architect"
    intent: "Perform rapid triage of incident {incident_id} to determine root cause and blast radius"
    phase: "REVIEW"
    priority: 10
    context_refs:
      - "file:{affected_system}"
    constraints:
      - "Answer within 15 minutes: What broke? When? Who is affected?"
      - "Check: recent deployments, config changes, upstream dependencies"
      - "Establish: war room, incident commander, communications channel"
    token_budget_hint: 1000
    options:
      - id: "A"
        label: "Rollback / Hotfix"
        description: "Revert recent change causing the incident"
        next_node_id: "rollback_plan"
      - id: "B"
        label: "Infrastructure Failover"
        description: "Route traffic to healthy region or fallback system"
        next_node_id: "failover_plan"
      - id: "C"
        label: "Deep Investigation Needed"
        description: "Root cause unclear — begin systematic investigation"
        next_node_id: "investigation"

  security_containment:
    summary: "Containing security incident {incident_id}"
    role: "reviewer"
    intent: "Contain and assess security incident {incident_id} affecting {affected_system}"
    phase: "REVIEW"
    priority: 10
    context_refs:
      - "file:{affected_system}"
    constraints:
      - "IMMEDIATELY: isolate affected systems, revoke compromised credentials"
      - "Preserve forensic evidence before remediation"
      - "Notify: security team, legal, privacy officer if PII involved"
      - "Do NOT: reboot or modify systems before forensic snapshot"
    token_budget_hint: 1200
    options:
      - id: "A"
        label: "Forensic Investigation"
        description: "Collect evidence and trace attack vector"
        next_node_id: "forensic_analysis"
      - id: "B"
        label: "Immediate Remediation"
        description: "Patch and restore systems under controlled conditions"
        next_node_id: "remediation"

  investigation:
    summary: "Investigating root cause of {incident_id}"
    role: "researcher"
    intent: "Systematically investigate root cause of incident {incident_id} in {affected_system}"
    phase: "RESEARCH"
    priority: 9
    context_refs:
      - "file:{affected_system}"
    constraints:
      - "Use: 5-Why analysis, fault tree analysis, or timeline reconstruction"
      - "Check: logs, metrics, traces, error rates across the time window"
      - "Identify: contributing factors, not just immediate cause"
    token_budget_hint: 1500
    options:
      - id: "A"
        label: "Apply Immediate Fix"
        description: "Root cause identified — implement targeted fix"
        next_node_id: "remediation"
      - id: "B"
        label: "Escalate Investigation"
        description: "Need more data or expertise to determine root cause"
        next_node_id: "escalation"

  rollback_plan:
    summary: "Planning rollback for incident {incident_id}"
    role: "implementer"
    intent: "Create and execute safe rollback plan to restore {affected_system} to healthy state"
    phase: "IMPLEMENTATION"
    priority: 10
    context_refs:
      - "file:{affected_system}"
    constraints:
      - "Identify: last known good version or configuration"
      - "Define: rollback steps with verification checkpoints"
      - "Communicate: status updates every 10 minutes during rollback"
    token_budget_hint: 1200
    options:
      - id: "A"
        label: "Execute Rollback"
        description: "Proceed with rollback and monitor recovery"
        next_node_id: "remediation"
      - id: "B"
        label: "Rollback Too Risky"
        description: "Forward-fix instead — create targeted hotfix"
        next_node_id: "remediation"

  failover_plan:
    summary: "Executing failover for {affected_system}"
    role: "architect"
    intent: "Execute infrastructure failover to restore {affected_system} availability"
    phase: "IMPLEMENTATION"
    priority: 10
    context_refs: []
    constraints:
      - "Steps: update DNS/load balancer, verify failover region health"
      - "Monitor: traffic shift, error rates, latency during failover"
      - "Document: failover decision, time, and impact"
    token_budget_hint: 1200
    options:
      - id: "A"
        label: "Validate Recovery"
        description: "Confirm service restored and monitor for stability"
        next_node_id: "remediation"

  forensic_analysis:
    summary: "Forensic analysis of security incident {incident_id}"
    role: "researcher"
    intent: "Perform digital forensics on {affected_system} to trace attack vector and scope of compromise"
    phase: "RESEARCH"
    priority: 9
    context_refs: []
    constraints:
      - "Collect: system logs, network flows, process trees, memory dumps"
      - "Reconstruct: attacker timeline and access patterns"
      - "Identify: compromised accounts, data accessed/exfiltrated"
    token_budget_hint: 2000
    options:
      - id: "A"
        label: "Create Remediation Plan"
        description: "Based on forensics, plan full remediation"
        next_node_id: "remediation"
      - id: "B"
        label: "Regulatory Notification"
        description: "Assess breach notification requirements"
        next_node_id: "escalation"

  escalation:
    summary: "Escalating incident {incident_id}"
    role: "architect"
    intent: "Escalate incident {incident_id} with full status to senior stakeholders"
    phase: "SYNTHESIS"
    priority: 9
    context_refs: []
    constraints:
      - "Brief: what happened, impact, timeline, current status, needs"
      - "Identify: blockers requiring executive decision or external help"
      - "Define: next update time and escalation path"
    token_budget_hint: 1000
    options:
      - id: "A"
        label: "Continue Investigation"
        description: "Resume investigation with additional resources"
        next_node_id: "investigation"
      - id: "B"
        label: "Vendor Engagement"
        description: "Engage cloud provider or vendor support"
        next_node_id: "remediation"

  remediation:
    summary: "Remediating incident {incident_id} on {affected_system}"
    role: "implementer"
    intent: "Implement full remediation for incident {incident_id} and restore normal operations"
    phase: "IMPLEMENTATION"
    priority: 9
    context_refs:
      - "file:{affected_system}"
    constraints:
      - "Implement: fix, verify with smoke tests, monitor for 30+ minutes"
      - "Update: status page, incident channel with resolution timeline"
      - "Document: all changes made during incident for postmortem"
    token_budget_hint: 1500
    options:
      - id: "A"
        label: "Write Postmortem"
        description: "Document incident for learning and prevention"
        next_node_id: "postmortem"

  postmortem:
    summary: "Writing postmortem for incident {incident_id}"
    role: "integrator"
    intent: "Create blameless postmortem for incident {incident_id} to drive systemic improvements"
    phase: "SYNTHESIS"
    priority: 7
    context_refs: []
    constraints:
      - "Format: incident timeline, impact, root cause, contributing factors"
      - "Blameless: focus on systems and processes, not individuals"
      - "Action items: concrete, assigned, and time-bound improvements"
      - "Share with: engineering team, leadership, and reliability review"
    token_budget_hint: 2000
    options: []
